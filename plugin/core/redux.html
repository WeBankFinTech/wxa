<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ | wxa.js</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/wxa/wxajs.png">
    <meta name="description" content="æ¸è¿›å¼å°ç¨‹åºå¼€å‘æ¡†æ¶">
    <link rel="preload" href="/wxa/assets/css/0.styles.f83c3963.css" as="style"><link rel="preload" href="/wxa/assets/js/app.58e7e8f2.js" as="script"><link rel="preload" href="/wxa/assets/js/5.38cbe0cd.js" as="script"><link rel="preload" href="/wxa/assets/js/4.27b682a4.js" as="script"><link rel="preload" href="/wxa/assets/js/40.77dce1e4.js" as="script"><link rel="preload" href="/wxa/assets/js/7.28cc5d92.js" as="script"><link rel="prefetch" href="/wxa/assets/js/10.f6aaeb80.js"><link rel="prefetch" href="/wxa/assets/js/11.54255dea.js"><link rel="prefetch" href="/wxa/assets/js/12.9923669f.js"><link rel="prefetch" href="/wxa/assets/js/13.1c3c51ba.js"><link rel="prefetch" href="/wxa/assets/js/14.a0833e0c.js"><link rel="prefetch" href="/wxa/assets/js/15.14ca9f93.js"><link rel="prefetch" href="/wxa/assets/js/16.96744209.js"><link rel="prefetch" href="/wxa/assets/js/17.db3f7f4a.js"><link rel="prefetch" href="/wxa/assets/js/18.3722b688.js"><link rel="prefetch" href="/wxa/assets/js/19.9fab0459.js"><link rel="prefetch" href="/wxa/assets/js/20.627e5bd5.js"><link rel="prefetch" href="/wxa/assets/js/21.a5183ffb.js"><link rel="prefetch" href="/wxa/assets/js/22.522e44df.js"><link rel="prefetch" href="/wxa/assets/js/23.e7e50950.js"><link rel="prefetch" href="/wxa/assets/js/24.2b9289cb.js"><link rel="prefetch" href="/wxa/assets/js/25.4f12003c.js"><link rel="prefetch" href="/wxa/assets/js/26.e8429a09.js"><link rel="prefetch" href="/wxa/assets/js/27.ba469541.js"><link rel="prefetch" href="/wxa/assets/js/28.4a04d925.js"><link rel="prefetch" href="/wxa/assets/js/29.f0aa0874.js"><link rel="prefetch" href="/wxa/assets/js/30.ef445ed3.js"><link rel="prefetch" href="/wxa/assets/js/31.cc738cb9.js"><link rel="prefetch" href="/wxa/assets/js/32.045f84a7.js"><link rel="prefetch" href="/wxa/assets/js/33.263c09fe.js"><link rel="prefetch" href="/wxa/assets/js/34.e74abdf3.js"><link rel="prefetch" href="/wxa/assets/js/35.55479d1a.js"><link rel="prefetch" href="/wxa/assets/js/36.3617d1b9.js"><link rel="prefetch" href="/wxa/assets/js/37.be5b6f82.js"><link rel="prefetch" href="/wxa/assets/js/38.035f93a0.js"><link rel="prefetch" href="/wxa/assets/js/39.9f70789c.js"><link rel="prefetch" href="/wxa/assets/js/41.20b0cce6.js"><link rel="prefetch" href="/wxa/assets/js/42.f50982ec.js"><link rel="prefetch" href="/wxa/assets/js/43.f0b1c738.js"><link rel="prefetch" href="/wxa/assets/js/6.3f6d376f.js"><link rel="prefetch" href="/wxa/assets/js/8.92f109f1.js"><link rel="prefetch" href="/wxa/assets/js/9.615a09d6.js"><link rel="prefetch" href="/wxa/assets/js/vendors~docsearch.0af8f36c.js"><link rel="prefetch" href="/wxa/assets/js/vendors~notification.ccb96427.js">
    <link rel="stylesheet" href="/wxa/assets/css/0.styles.f83c3963.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wxa/" class="home-link router-link-active"><!----> <span class="site-name">wxa.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wxa/learn/guide/" class="nav-link">
  æ•™ç¨‹
</a></div><div class="nav-item"><a href="/wxa/core/" class="nav-link">
  CORE
</a></div><div class="nav-item"><a href="/wxa/cli/" class="nav-link">
  CLI
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CORE è¿è¡Œæ—¶æ’ä»¶" class="dropdown-title"><span class="title">CORE è¿è¡Œæ—¶æ’ä»¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="CORE è¿è¡Œæ—¶æ’ä»¶" class="mobile-dropdown-title"><span class="title">CORE è¿è¡Œæ—¶æ’ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/validate.html" class="nav-link">
  Validate è¡¨å•æ ¡éªŒ
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/watch.html" class="nav-link">
  Watch æ•°æ®ç›‘å¬
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/redux.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Redux å…¨å±€çŠ¶æ€ç®¡ç†
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/log.html" class="nav-link">
  Log æ—¥å¿—ä¸ŠæŠ¥
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CLI é¢„ç¼–è¯‘æ’ä»¶" class="dropdown-title"><span class="title">CLI é¢„ç¼–è¯‘æ’ä»¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="CLI é¢„ç¼–è¯‘æ’ä»¶" class="mobile-dropdown-title"><span class="title">CLI é¢„ç¼–è¯‘æ’ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/uglifyjs.html" class="nav-link">
  UglifyJS ä»£ç å‹ç¼©
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/replace.html" class="nav-link">
  Replace å­—ç¬¦æ›¿æ¢
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/copy.html" class="nav-link">
  Copy é™æ€èµ„æºå¼•å…¥
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/hijack.html" class="nav-link">
  hijack äº‹ä»¶åŠ«æŒ
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/minify-wxml.html" class="nav-link">
  Minify-wxml wxmlå‹ç¼©
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/postcss.html" class="nav-link">
  Postcss CSSé¢„å¤„ç†
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/da.html" class="nav-link">
  DA ä¾èµ–åˆ†æ
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wxa/learn/guide/" class="nav-link">
  æ•™ç¨‹
</a></div><div class="nav-item"><a href="/wxa/core/" class="nav-link">
  CORE
</a></div><div class="nav-item"><a href="/wxa/cli/" class="nav-link">
  CLI
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CORE è¿è¡Œæ—¶æ’ä»¶" class="dropdown-title"><span class="title">CORE è¿è¡Œæ—¶æ’ä»¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="CORE è¿è¡Œæ—¶æ’ä»¶" class="mobile-dropdown-title"><span class="title">CORE è¿è¡Œæ—¶æ’ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/validate.html" class="nav-link">
  Validate è¡¨å•æ ¡éªŒ
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/watch.html" class="nav-link">
  Watch æ•°æ®ç›‘å¬
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/redux.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Redux å…¨å±€çŠ¶æ€ç®¡ç†
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/log.html" class="nav-link">
  Log æ—¥å¿—ä¸ŠæŠ¥
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CLI é¢„ç¼–è¯‘æ’ä»¶" class="dropdown-title"><span class="title">CLI é¢„ç¼–è¯‘æ’ä»¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="CLI é¢„ç¼–è¯‘æ’ä»¶" class="mobile-dropdown-title"><span class="title">CLI é¢„ç¼–è¯‘æ’ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/uglifyjs.html" class="nav-link">
  UglifyJS ä»£ç å‹ç¼©
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/replace.html" class="nav-link">
  Replace å­—ç¬¦æ›¿æ¢
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/copy.html" class="nav-link">
  Copy é™æ€èµ„æºå¼•å…¥
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/hijack.html" class="nav-link">
  hijack äº‹ä»¶åŠ«æŒ
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/minify-wxml.html" class="nav-link">
  Minify-wxml wxmlå‹ç¼©
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/postcss.html" class="nav-link">
  Postcss CSSé¢„å¤„ç†
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/da.html" class="nav-link">
  DA ä¾èµ–åˆ†æ
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wxa/plugin/core/redux.html#å®‰è£…" class="sidebar-link">å®‰è£…</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxa/plugin/core/redux.html#åŸºæœ¬ç”¨æ³•" class="sidebar-link">åŸºæœ¬ç”¨æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#æŒ‚è½½æ’ä»¶" class="sidebar-link">æŒ‚è½½æ’ä»¶</a></li><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#è·å–å…¨å±€çŠ¶æ€" class="sidebar-link">è·å–å…¨å±€çŠ¶æ€</a></li><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#ä¸ªæ€§åŒ–é¡µé¢æ•°æ®" class="sidebar-link">ä¸ªæ€§åŒ–é¡µé¢æ•°æ®</a></li></ul></li><li><a href="/wxa/plugin/core/redux.html#åˆ†åŒ…ç”¨æ³•" class="sidebar-link">åˆ†åŒ…ç”¨æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#æŒ‚è½½æ’ä»¶-2" class="sidebar-link">æŒ‚è½½æ’ä»¶</a></li><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#åŠ¨æ€æ·»åŠ åˆ†åŒ…-reducer" class="sidebar-link">åŠ¨æ€æ·»åŠ åˆ†åŒ… Reducer</a></li></ul></li><li><a href="/wxa/plugin/core/redux.html#è°ƒè¯•-redux" class="sidebar-link">è°ƒè¯• Redux</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxa/plugin/core/redux.html#æŒä¹…åŒ–æ•°æ®" class="sidebar-link">æŒä¹…åŒ–æ•°æ®</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxa/plugin/core/redux.html#å®æ—¶æ—¥å¿—" class="sidebar-link">å®æ—¶æ—¥å¿—</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxa/plugin/core/redux.html#é…ç½®" class="sidebar-link">é…ç½®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#reducers" class="sidebar-link">reducers</a></li><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#middlewares" class="sidebar-link">middlewares</a></li><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#initialstate" class="sidebar-link">initialState</a></li><li class="sidebar-sub-header"><a href="/wxa/plugin/core/redux.html#debug" class="sidebar-link">debug</a></li></ul></li><li><a href="/wxa/plugin/core/redux.html#æŠ€æœ¯ç»†èŠ‚" class="sidebar-link">æŠ€æœ¯ç»†èŠ‚</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><a href="https://www.npmjs.com/package/@wxa/redux" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/@wxa/redux/latest.svg" alt="NPM version"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <img src="https://img.shields.io/bundlephobia/minzip/@wxa/redux/latest.svg" alt="npm bundle size (minified + gzip)"></p> <p>redux å°ç¨‹åºé€‚é…æ–¹æ¡ˆã€‚åœ¨å°ç¨‹åºå¼€å‘ä¸­ä½¿ç”¨ <code>redux</code> ç®¡ç†å…¨å±€çŠ¶æ€ã€‚</p> <p>å°½ç®¡å°ç¨‹åºå…¥é—¨é—¨æ§›éå¸¸ä¹‹ä½ï¼Œä½†æ˜¯åœ¨é¡¹ç›®ä¸åœçš„è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„é¡¹ç›®ä»£ç å¤æ‚åº¦ä¹Ÿä¼šè¶Šæ¥è¶Šé«˜ï¼Œä»å‰æˆ‘ä»¬å¯ä»¥å°†è·¨é¡µé¢æ•°æ®ç®¡ç†åœ¨<a href="/wxa/core/API.html#storage">Storage</a>æˆ–è€…<a href="/wxa/core/API.html#sessionstorage">SessionStorage</a>ä¸­ï¼Œåˆ©ç”¨ä¸€å®šçš„ä»£ç è§„èŒƒæ¥ç®¡ç†ä¸åŒé¡µé¢ä¸åŒå¼€å‘è€…çš„æ•°æ®ï¼Œä½†éšç€æ—¶é—´çš„æ¨ç§»è¿™ç§æ–¹å¼ä¼šé€ æˆä»£ç ã€æ•°æ®è¿‡äºåˆ†æ•£ï¼Œä¸”å®¹æ˜“å‡ºé”™è¦†ç›–ã€‚å†è€…æ¯ä¸ªé¡µé¢é—´éƒ½éœ€è¦æ‰‹åŠ¨çš„å» <code>storage</code> è¯»å–æ•°æ®ï¼Œç•¥æ˜¾ç¹çã€‚</p> <p>å½“é¡¹ç›®å¼€å§‹å˜å¾—å¤æ‚ï¼Œæˆ‘ä»¬æƒ³è¦ç»Ÿä¸€çš„ç®¡ç†èµ·çŠ¶æ€æ•°æ®ï¼Œè‡ªåŠ¨çš„åŒæ­¥ã€åˆ†å‘æ•°æ®åˆ°éœ€è¦çš„é¡µé¢ã€ç»„ä»¶ï¼ˆ<code>Reactive</code>ï¼‰ã€‚</p> <h2 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ä½¿ç”¨npmå®‰è£…</span>
<span class="token function">npm</span> i -S @wxa/redux
<span class="token comment"># ä½¿ç”¨yarnå®‰è£…</span>
<span class="token function">yarn</span> <span class="token function">add</span> @wxa/redux
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="header-anchor">#</a> åŸºæœ¬ç”¨æ³•</h2> <h3 id="æŒ‚è½½æ’ä»¶"><a href="#æŒ‚è½½æ’ä»¶" class="header-anchor">#</a> æŒ‚è½½æ’ä»¶</h3> <p>åœ¨<code>app.js</code>/<code>app.wxa</code>ä¸­æŒ‚è½½æ’ä»¶</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js or app.wxa</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>App<span class="token punctuation">,</span> wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token comment">// å¼•å…¥æ’ä»¶æ–¹æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxaRedux<span class="token punctuation">,</span> combineReducers<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span>
<span class="token keyword">import</span> promiseMiddleware <span class="token keyword">from</span> <span class="token string">'redux-promise'</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œæ’ä»¶</span>
wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wxaRedux<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    reducers<span class="token operator">:</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token operator">...</span>your reducer<span class="token punctuation">)</span><span class="token punctuation">,</span>
    middlewares<span class="token operator">:</span> <span class="token punctuation">[</span>promiseMiddleware<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

@App
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æ³¨å†Œå®Œ redux æ’ä»¶ä¹‹åï¼Œå°†ä¼šè‡ªåŠ¨çš„è°ƒç”¨ <code>redux.createStore</code> åˆ›å»ºä¸€ä¸ªç”¨äºå­˜å‚¨å…¨å±€çŠ¶æ€æ•°æ® <code>store</code>ï¼Œå¹¶ä¸”æ’ä»¶ä¼šåœ¨è‡ªåŠ¨çš„æŒ‚è½½ <code>store</code> åˆ° Appã€Componentã€Page å®ä¾‹ä¸­ <code>$store</code> ã€‚</p> <p>é€šè¿‡ <code>this.$store.getState()</code>å¯ä»¥è·å¾—æ‰€æœ‰å…¨å±€çŠ¶æ€ã€‚</p> <p>é€šè¿‡ <code>this.$store.dispatch()</code>å¯ä»¥æäº¤ä¸€ä¸ªçŠ¶æ€ä¿®æ”¹çš„ actionã€‚</p> <p>æ›´è¯¦ç»†çš„ <a href="https://redux.js.org/api/store" target="_blank" rel="noopener noreferrer">store api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="è·å–å…¨å±€çŠ¶æ€"><a href="#è·å–å…¨å±€çŠ¶æ€" class="header-anchor">#</a> è·å–å…¨å±€çŠ¶æ€</h3> <p>åœ¨é¡µé¢/ç»„ä»¶ç±»ä¸­å®šä¹‰ <code>mapState</code> å¯¹è±¡ï¼ŒæŒ‡å®šå…³è”çš„å…¨å±€çŠ¶æ€ï¼ˆåœ¨<code>react</code>ä¸­å«<code>connect</code>ï¼‰ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Page<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@Page
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    mapState <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">todolist$</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>
        <span class="token function-variable function">userInfo$</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>userInfo
    <span class="token punctuation">}</span>

    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// dispatch change state.</span>
        <span class="token comment">// todo list will auto add one.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'Add_todo_list'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token string">'coding today'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ç„¶åå†<code>template</code>ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨æ˜ å°„çš„æ•°æ®äº†ã€‚</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{userInfo$.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{todolist$}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{key+1}}{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¾—ç›Šäº <code>@wxa/core</code> çš„ <a href="/wxa/core/API.html#vm-diff">diffæ–¹æ³•</a>ï¼Œreduxåœ¨åŒæ­¥æ•°æ®çš„æ—¶å€™åªä¼šå¢é‡çš„ä¿®æ”¹æ•°æ®ï¼Œè€Œä¸æ˜¯å…¨é‡è¦†ç›– ğŸ˜</p> <h4 id="åœ¨ä»»æ„ä½ç½®è·å–å…¨å±€çŠ¶æ€æ•°æ®"><a href="#åœ¨ä»»æ„ä½ç½®è·å–å…¨å±€çŠ¶æ€æ•°æ®" class="header-anchor">#</a> åœ¨ä»»æ„ä½ç½®è·å–å…¨å±€çŠ¶æ€æ•°æ®</h4> <p>ç¼–å†™ä¸€äº›é€šç”¨çš„åŸºç¡€å‡½æ•°æä¾›ç»™é¡µé¢è°ƒç”¨çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šéœ€è¦ä» <code>store</code> ä¸­è¯»å–ç›¸åº”æ•°æ®åšå¤„ç†ã€‚ ä¾‹å¦‚åœ¨æˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰è¯·æ±‚çš„ postdata ä¸­ç»Ÿä¸€çš„åŠ ä¸Šç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥è¿™ä¹ˆå®ç°ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ä»»æ„ api.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>fetch<span class="token punctuation">}</span> <span class="token keyword">from</span> '@wxa<span class="token operator">/</span>core`<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>getStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">const</span> <span class="token function-variable function">customFetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>idNo<span class="token punctuation">,</span> name<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UserModel<span class="token punctuation">;</span>

    <span class="token comment">// æ¯ä¸ªè¯·æ±‚è‡ªåŠ¨æ·»åŠ ç”¨æˆ·</span>
    args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        idNo<span class="token punctuation">,</span> name
        <span class="token operator">...</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="ä¸ªæ€§åŒ–é¡µé¢æ•°æ®"><a href="#ä¸ªæ€§åŒ–é¡µé¢æ•°æ®" class="header-anchor">#</a> ä¸ªæ€§åŒ–é¡µé¢æ•°æ®</h3> <p>æœ‰æ—¶æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸´æ—¶æ”¹å†™ä¸€ä¸‹æ•°æ®ç”¨äºå±•ç¤ºï¼Œå®ç°ç±»ä¼¼ <code>vue</code> <code>computed</code> çš„æ•ˆæœï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›¸åº”çš„æ”¹é€  mapStateã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    mapState <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">userInfo$</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> model <span class="token operator">=</span> state<span class="token punctuation">.</span>UserModel<span class="token punctuation">;</span>

            <span class="token comment">// è‡ªåŠ¨æ©ç ç”¨æˆ·çš„èº«ä»½è¯ã€å§“å</span>
            <span class="token comment">// diff æ•°æ®å¹¶è‡ªåŠ¨è°ƒç”¨ setData</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$diff</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                idNoCover<span class="token operator">:</span> model<span class="token punctuation">.</span>idNo<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/([\d]{4})(\d{10})([\dxX]{4})/</span><span class="token punctuation">,</span> <span class="token string">'$1***$3'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> model
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="åˆ†åŒ…ç”¨æ³•"><a href="#åˆ†åŒ…ç”¨æ³•" class="header-anchor">#</a> åˆ†åŒ…ç”¨æ³•</h2> <p>å½“å°ç¨‹åºåº”ç”¨å¼€å§‹ä½¿ç”¨<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages.html" target="_blank" rel="noopener noreferrer">åˆ†åŒ…æŠ€æœ¯<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>çš„æ—¶å€™ï¼Œredux æ–¹æ¡ˆä¹Ÿéœ€è¦ç›¸åº”çš„åšå‡ºä¼˜åŒ–ï¼Œåˆ†åŒ…æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p> <blockquote><p>å¼•ç”¨åŸåˆ™</p> <ul><li>packageA æ— æ³• require packageB JS æ–‡ä»¶ï¼Œä½†å¯ä»¥ require appã€è‡ªå·± package å†…çš„ JS æ–‡ä»¶</li> <li>packageA æ— æ³• import packageB çš„ templateï¼Œä½†å¯ä»¥ require appã€è‡ªå·± package å†…çš„ template</li> <li>packageA æ— æ³•ä½¿ç”¨ packageB çš„èµ„æºï¼Œä½†å¯ä»¥ä½¿ç”¨ appã€è‡ªå·± package å†…çš„èµ„æº</li></ul></blockquote> <p>å³å½“åˆ†åŒ… A å®šä¹‰äº†è‡ªå·±ä¸šåŠ¡é€»è¾‘çš„æ•°æ® model ä¹‹åï¼Œä¸”è¯¥ model æ— æ³•è¢«å…¶ä»–åˆ†åŒ…å¤ç”¨ï¼Œåˆ™æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠå¯¹åº” model æ”¾åˆ°åˆ†åŒ…çš„é¡µé¢ä¸­ï¼Œæ‡’åŠ è½½å¯¹åº” <code>redux.reducer</code>ï¼Œä»¥æ­¤å‡å°‘ä¸»åŒ…ä½“ç§¯ã€‚</p> <p>ä¸ºäº†åšåˆ°æ‡’åŠ è½½å¯¹åº”çš„ reducerï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ”¹é€ ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚</p> <h3 id="æŒ‚è½½æ’ä»¶-2"><a href="#æŒ‚è½½æ’ä»¶-2" class="header-anchor">#</a> æŒ‚è½½æ’ä»¶</h3> <p>åœ¨<code>app.js</code>/<code>app.wxa</code>ä¸­ï¼Œæ”¹é€  <code>reducer</code> çš„æ³¨å†Œæ–¹å¼ã€‚</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// app.js or app.wxa</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>App<span class="token punctuation">,</span> wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token comment">// å¼•å…¥æ’ä»¶æ–¹æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxaRedux<span class="token punctuation">,</span> combineReducers<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span>
<span class="token keyword">import</span> promiseMiddleware <span class="token keyword">from</span> <span class="token string">'redux-promise'</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œæ’ä»¶</span>
wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wxaRedux<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// reducers: combineReducers(...your reducer),</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        UserModel<span class="token operator">:</span> userReducer<span class="token punctuation">,</span>
        AppModel<span class="token operator">:</span> appReducer<span class="token punctuation">,</span>
        <span class="token operator">...</span>your reducer
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    middlewares<span class="token operator">:</span> <span class="token punctuation">[</span>promiseMiddleware<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

@App
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="åŠ¨æ€æ·»åŠ åˆ†åŒ…-reducer"><a href="#åŠ¨æ€æ·»åŠ åˆ†åŒ…-reducer" class="header-anchor">#</a> åŠ¨æ€æ·»åŠ åˆ†åŒ… Reducer</h3> <p>å‡è®¾æˆ‘ä»¬åœ¨åˆ†åŒ… A ä¸­å®šä¹‰äº†ä¸“é—¨ç”¨äºè®¢å•å¤„ç†çš„ <code>reducer</code>ï¼Œåˆ†åŒ…å…¥å£é¡µé¢ä¸º <code>subpages/A/pages/board</code>ã€‚</p> <p>åœ¨åˆ†åŒ…é¡µé¢è¢«ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬éœ€è¦åŠ¨æ€çš„æ³¨å†Œä¸€ä¸ªæ–°çš„ <code>reducer</code>ã€‚</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted">Â </div><br><br><br><div class="highlighted">Â </div><br></div><pre class="language-js"><code><span class="token comment">// subpages/A/pages/board</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>reducerRegistry<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> AOrderModel <span class="token keyword">from</span> <span class="token string">'/subpages/A/models/order.model.js'</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œå¯¹åº”çš„æ•°æ® model</span>
reducerRegistry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'AOrderModel'</span><span class="token punctuation">,</span> AOrderModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ³¨å†Œå®Œæ¯•ä¹‹åï¼Œåç»­æ‰€æœ‰åˆ†åŒ… A çš„é¡µé¢éƒ½å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨ <code>mapState</code> ä¸­æ˜ å°„é¡µé¢éœ€è¦ä½¿ç”¨çš„çŠ¶æ€æ•°æ®ã€‚</p> <h2 id="è°ƒè¯•-redux"><a href="#è°ƒè¯•-redux" class="header-anchor">#</a> è°ƒè¯• Redux</h2> <p><code>@wxa/redux</code> æä¾›äº†å°ç¨‹åº <code>redux-remote-devtools</code> çš„é€‚é…ä»£ç ã€‚ç¨å¾®æ”¹é€ ä¸€ä¸‹æˆ‘ä»¬çš„æŒ‚è½½æ’ä»¶éƒ¨åˆ†çš„ä»£ç å³å¯ä½¿ç”¨ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>App<span class="token punctuation">,</span> wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token comment">// å¼•å…¥æ’ä»¶æ–¹æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxaRedux<span class="token punctuation">,</span> combineReducers<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> composeWithDevTools <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux/libs/remote-redux-devtools.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> promiseMiddleware <span class="token keyword">from</span> <span class="token string">'redux-promise'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token punctuation">{</span> realtime<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> port<span class="token operator">:</span> <span class="token number">8000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œæ’ä»¶</span>
wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wxaRedux<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// reducers: combineReducers(...your reducer),</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        UserModel<span class="token operator">:</span> userReducer<span class="token punctuation">,</span>
        AppModel<span class="token operator">:</span> appReducer<span class="token punctuation">,</span>
        <span class="token operator">...</span>your reducer
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    middlewares<span class="token operator">:</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>promiseMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æ‰“å¼€å¼€å‘è€…å·¥å…·ä¸æ ¡éªŒåˆæ³•åŸŸåå¼€å…³ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ <code>redux-devtools</code> äº†ã€‚</p> <p>ç”±äº <code>devtools</code> ä»…ç”¨äºå¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>wxa</code> æä¾›çš„ä¾èµ–åˆ†æèƒ½åŠ›ï¼ŒæŒ‰éœ€å¼•å…¥ã€‚</p> <p>æ”¹å†™ä¸Šç»­é…ç½®å¦‚ä¸‹ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>App<span class="token punctuation">,</span> wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token comment">// å¼•å…¥æ’ä»¶æ–¹æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxaRedux<span class="token punctuation">,</span> combineReducers<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span>
<span class="token keyword">import</span> promiseMiddleware <span class="token keyword">from</span> <span class="token string">'redux-promise'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">composeEnhancers</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> composeWithDevTools <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@wxa/redux/libs/remote-redux-devtools.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>composeWithDevTools<span class="token punctuation">;</span>
    composeEnhancers <span class="token operator">=</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token punctuation">{</span> realtime<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> port<span class="token operator">:</span> <span class="token number">8000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ³¨å†Œæ’ä»¶</span>
wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wxaRedux<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// reducers: combineReducers(...your reducer),</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        UserModel<span class="token operator">:</span> userReducer<span class="token punctuation">,</span>
        AppModel<span class="token operator">:</span> appReducer<span class="token punctuation">,</span>
        <span class="token operator">...</span>your reducer
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    middlewares<span class="token operator">:</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>promiseMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>å¦‚ä¸Šé…ç½®ï¼Œå½“ <code>process.env.NODE_ENV</code> è®¾ç½®ä¸ºç”Ÿäº§ç¯å¢ƒçš„æ—¶å€™ï¼Œ<code>@wxa/redux/libs/remote-redux-devtools.js</code> å°†ä¸ä¼šè¢«æ‰“åŒ…è¿› <code>dist</code></p> <h2 id="æŒä¹…åŒ–æ•°æ®"><a href="#æŒä¹…åŒ–æ•°æ®" class="header-anchor">#</a> æŒä¹…åŒ–æ•°æ®</h2> <p>æŸäº›åœºæ™¯ï¼Œä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬éœ€è¦å°†å¯¹åº”æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç”¨æˆ·å¯ä»¥ç›´æ¥çœ‹åˆ°å¯¹åº”é¡µé¢ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦å°† <code>store</code> çš„æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://github.com/rt2zz/redux-persist" target="_blank" rel="noopener noreferrer"><code>redux-persist</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ç”¨äºæŒä¹…åŒ–æ•°æ®ã€‚</p> <p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">,</span> App<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> wxaRedux <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> wxPersistStorage <span class="token keyword">from</span> <span class="token string">'@wxa/redux/libs/wx.storage.min.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>persistStore<span class="token punctuation">,</span> persistReducer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-persist'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> orderModel <span class="token keyword">from</span> <span class="token string">'./order.model.js'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> persistOrderModel <span class="token operator">=</span> <span class="token function">persistReducer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    key<span class="token operator">:</span> <span class="token string">'orderModel'</span><span class="token punctuation">,</span>
    storage<span class="token operator">:</span> wxPersistStorage<span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// è¶…æ—¶æ—¶é—´ï¼Œè®¾ç½®ä¸º null</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> orderModel<span class="token punctuation">)</span><span class="token punctuation">;</span>

wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wxaRedux<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        orderModel<span class="token operator">:</span> persistOrderModel
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

@App
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å†·å¯åŠ¨å¼€å§‹å°±åŠ è½½ç¼“å­˜æ•°æ®</span>
        <span class="token function">persistStore</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>$storeReady<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="å®æ—¶æ—¥å¿—"><a href="#å®æ—¶æ—¥å¿—" class="header-anchor">#</a> å®æ—¶æ—¥å¿—</h2> <p>æˆ‘ä»¬å¯ä»¥ç»“åˆå°ç¨‹åº<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/realtimelog/" target="_blank" rel="noopener noreferrer">å®æ—¶æ—¥å¿—<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>å’Œ <code>redux-logger</code> ä¸€èµ·ä½¿ç”¨ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">,</span> App<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createLogger<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-logger'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> wxaRedux <span class="token keyword">from</span> <span class="token string">'@wxa/redux'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> log <span class="token operator">=</span> wx<span class="token punctuation">.</span>getRealtimeLogManager <span class="token operator">?</span> wx<span class="token punctuation">.</span><span class="token function">getRealtimeLogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> console<span class="token punctuation">;</span>

<span class="token keyword">let</span> logger <span class="token operator">=</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    logger<span class="token operator">:</span> log
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wxaRedux<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span>your reducers<span class="token punctuation">}</span><span class="token punctuation">,</span>
    middlewares<span class="token operator">:</span> <span class="token punctuation">[</span>logger<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>é…ç½®å®Œæ¯•ä¹‹åï¼Œé¡¹ç›®ä¸­æ‰€æœ‰çš„ <code>Action</code> æ—¥å¿—éƒ½å°†ä¸ŠæŠ¥åˆ°å¾®ä¿¡çš„å®æ—¶æ—¥å¿—åå°ï¼Œå¼€å‘è€…å¯ä»¥ç™»å½• mp.weixin.qq.com æŸ¥çœ‹ç”¨æˆ·æ‰€æœ‰æ“ä½œè®°å½•ã€‚</p> <h2 id="é…ç½®"><a href="#é…ç½®" class="header-anchor">#</a> é…ç½®</h2> <h3 id="reducers"><a href="#reducers" class="header-anchor">#</a> reducers</h3> <ul><li><strong>ç±»å‹</strong>:
<ul><li><strong>Function</strong> <code>combineReducers(...reducer)</code>çš„è¿”å›</li> <li><strong>Object</strong> <code>reducer</code> åˆ—è¡¨ï¼Œç”¨äºåŠ¨æ€æ³¨å†Œåœºæ™¯</li></ul></li></ul> <h3 id="middlewares"><a href="#middlewares" class="header-anchor">#</a> middlewares</h3> <ul><li><strong>ç±»å‹</strong>:
<ul><li><strong>Array</strong> redux ä¸­é—´ä»¶åˆ—è¡¨</li> <li><strong>Function</strong> <code>applyMiddleware(...middlewares)</code>çš„è¿”å›</li></ul></li></ul> <h3 id="initialstate"><a href="#initialstate" class="header-anchor">#</a> initialState</h3> <ul><li><strong>ç±»å‹</strong>:
<ul><li><strong>any</strong> reducer åˆå§‹çŠ¶æ€ï¼Œå‚è€ƒ <a href="https://redux.js.org/api/createstore" target="_blank" rel="noopener noreferrer"><code>redux æ–‡æ¡£</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="debug"><a href="#debug" class="header-anchor">#</a> debug</h3> <ul><li><strong>ç±»å‹</strong>:
<ul><li><strong>Boolean</strong> <code>false</code></li></ul></li></ul> <p>æ˜¯å¦æ‰“å°æ’ä»¶æ—¥å¿—</p> <h2 id="æŠ€æœ¯ç»†èŠ‚"><a href="#æŠ€æœ¯ç»†èŠ‚" class="header-anchor">#</a> æŠ€æœ¯ç»†èŠ‚</h2> <p><code>wxa/redux</code>æ ¹æ®ä¸åŒçš„å®ä¾‹ç±»å‹æœ‰ä¸åŒçš„ä»»åŠ¡ï¼Œåœ¨Appå±‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>store</code>å¹¶æŒ‚è½½åˆ°appä¸­ï¼Œåœ¨<code>Page</code>å’Œ<code>Component</code>å±‚ï¼Œæˆ‘ä»¬åšäº†æ›´å¤šç»†èŠ‚å¤„ç†ã€‚</p> <ul><li><p><strong>App Level</strong><br>
åˆ›å»º<code>store</code>ï¼Œåº”ç”¨reduxçš„ä¸­é—´ä»¶ï¼ŒæŒ‚è½½<code>store</code>åˆ°Appå®ä¾‹ã€‚</p></li> <li><p><strong>Page Level</strong><br>
åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæœ‰ä¸åŒçš„å¤„ç†ã€‚</p> <ul><li><code>onLoad</code> æ ¹æ®<code>mapState</code>è®¢é˜…<code>store</code>çš„æ•°æ®ï¼ŒåŒæ—¶æŒ‚è½½ä¸€ä¸ª<code>unsubscribe</code>æ–¹æ³•åˆ°å®ä¾‹ã€‚</li> <li><code>onShow</code> æ ‡è®°é¡µé¢å®ä¾‹<code>$$isCurrentPage</code>ä¸º<code>true</code>, åŒæ—¶åšä¸€æ¬¡çŠ¶æ€åŒæ­¥ã€‚å› ä¸ºæœ‰å¯èƒ½çŠ¶æ€åœ¨å…¶ä»–é¡µé¢åšäº†æ”¹å˜ã€‚</li> <li><code>onHide</code> é‡ç½®<code>$$isCurrentPage</code>ï¼Œè¿™æ ·å­é¡µé¢æ•°æ®å°±ä¸ä¼šè‡ªåŠ¨åˆ·æ–°äº†ã€‚</li> <li><code>onUnload</code> è°ƒç”¨<code>$unsubscribe</code>å–æ¶ˆè®¢é˜…çŠ¶æ€</li></ul></li></ul> <ol start="3"><li><strong>Component Level</strong><br>
é’ˆå¯¹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸåšä¸€äº›å•ç‹¬å¤„ç†
<ul><li><code>created</code> æŒ‚è½½<code>store</code></li> <li><code>attached</code> è®¢é˜…çŠ¶æ€ï¼Œå¹¶åŒæ­¥çŠ¶æ€åˆ°ç»„ä»¶ã€‚</li> <li><code>detached</code> å–æ¶ˆè®¢é˜…</li></ul></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/WeBankFinTech/wxa/edit/master/docs/plugin/core/redux.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡ç¼–è¾‘æ—¶é—´:</span> <span class="time">2020-9-11</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/wxa/assets/js/app.58e7e8f2.js" defer></script><script src="/wxa/assets/js/5.38cbe0cd.js" defer></script><script src="/wxa/assets/js/4.27b682a4.js" defer></script><script src="/wxa/assets/js/40.77dce1e4.js" defer></script><script src="/wxa/assets/js/7.28cc5d92.js" defer></script>
  </body>
</html>

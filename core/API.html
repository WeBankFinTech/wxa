<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API | wxa.js</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/wxa/wxajs.png">
    <meta name="description" content="渐进式小程序开发框架">
    <link rel="preload" href="/wxa/assets/css/0.styles.f83c3963.css" as="style"><link rel="preload" href="/wxa/assets/js/app.58e7e8f2.js" as="script"><link rel="preload" href="/wxa/assets/js/5.38cbe0cd.js" as="script"><link rel="preload" href="/wxa/assets/js/4.27b682a4.js" as="script"><link rel="preload" href="/wxa/assets/js/16.96744209.js" as="script"><link rel="preload" href="/wxa/assets/js/7.28cc5d92.js" as="script"><link rel="prefetch" href="/wxa/assets/js/10.f6aaeb80.js"><link rel="prefetch" href="/wxa/assets/js/11.54255dea.js"><link rel="prefetch" href="/wxa/assets/js/12.9923669f.js"><link rel="prefetch" href="/wxa/assets/js/13.1c3c51ba.js"><link rel="prefetch" href="/wxa/assets/js/14.a0833e0c.js"><link rel="prefetch" href="/wxa/assets/js/15.14ca9f93.js"><link rel="prefetch" href="/wxa/assets/js/17.db3f7f4a.js"><link rel="prefetch" href="/wxa/assets/js/18.3722b688.js"><link rel="prefetch" href="/wxa/assets/js/19.9fab0459.js"><link rel="prefetch" href="/wxa/assets/js/20.627e5bd5.js"><link rel="prefetch" href="/wxa/assets/js/21.a5183ffb.js"><link rel="prefetch" href="/wxa/assets/js/22.522e44df.js"><link rel="prefetch" href="/wxa/assets/js/23.e7e50950.js"><link rel="prefetch" href="/wxa/assets/js/24.2b9289cb.js"><link rel="prefetch" href="/wxa/assets/js/25.4f12003c.js"><link rel="prefetch" href="/wxa/assets/js/26.e8429a09.js"><link rel="prefetch" href="/wxa/assets/js/27.ba469541.js"><link rel="prefetch" href="/wxa/assets/js/28.4a04d925.js"><link rel="prefetch" href="/wxa/assets/js/29.f0aa0874.js"><link rel="prefetch" href="/wxa/assets/js/30.ef445ed3.js"><link rel="prefetch" href="/wxa/assets/js/31.cc738cb9.js"><link rel="prefetch" href="/wxa/assets/js/32.045f84a7.js"><link rel="prefetch" href="/wxa/assets/js/33.263c09fe.js"><link rel="prefetch" href="/wxa/assets/js/34.e74abdf3.js"><link rel="prefetch" href="/wxa/assets/js/35.55479d1a.js"><link rel="prefetch" href="/wxa/assets/js/36.3617d1b9.js"><link rel="prefetch" href="/wxa/assets/js/37.be5b6f82.js"><link rel="prefetch" href="/wxa/assets/js/38.035f93a0.js"><link rel="prefetch" href="/wxa/assets/js/39.9f70789c.js"><link rel="prefetch" href="/wxa/assets/js/40.77dce1e4.js"><link rel="prefetch" href="/wxa/assets/js/41.20b0cce6.js"><link rel="prefetch" href="/wxa/assets/js/42.f50982ec.js"><link rel="prefetch" href="/wxa/assets/js/43.f0b1c738.js"><link rel="prefetch" href="/wxa/assets/js/6.3f6d376f.js"><link rel="prefetch" href="/wxa/assets/js/8.92f109f1.js"><link rel="prefetch" href="/wxa/assets/js/9.615a09d6.js"><link rel="prefetch" href="/wxa/assets/js/vendors~docsearch.0af8f36c.js"><link rel="prefetch" href="/wxa/assets/js/vendors~notification.ccb96427.js">
    <link rel="stylesheet" href="/wxa/assets/css/0.styles.f83c3963.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wxa/" class="home-link router-link-active"><!----> <span class="site-name">wxa.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wxa/learn/guide/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/wxa/core/" class="nav-link router-link-active">
  CORE
</a></div><div class="nav-item"><a href="/wxa/cli/" class="nav-link">
  CLI
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CORE 运行时插件" class="dropdown-title"><span class="title">CORE 运行时插件</span> <span class="arrow down"></span></button> <button type="button" aria-label="CORE 运行时插件" class="mobile-dropdown-title"><span class="title">CORE 运行时插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/validate.html" class="nav-link">
  Validate 表单校验
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/watch.html" class="nav-link">
  Watch 数据监听
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/redux.html" class="nav-link">
  Redux 全局状态管理
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/log.html" class="nav-link">
  Log 日志上报
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CLI 预编译插件" class="dropdown-title"><span class="title">CLI 预编译插件</span> <span class="arrow down"></span></button> <button type="button" aria-label="CLI 预编译插件" class="mobile-dropdown-title"><span class="title">CLI 预编译插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/uglifyjs.html" class="nav-link">
  UglifyJS 代码压缩
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/replace.html" class="nav-link">
  Replace 字符替换
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/copy.html" class="nav-link">
  Copy 静态资源引入
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/hijack.html" class="nav-link">
  hijack 事件劫持
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/minify-wxml.html" class="nav-link">
  Minify-wxml wxml压缩
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/postcss.html" class="nav-link">
  Postcss CSS预处理
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/da.html" class="nav-link">
  DA 依赖分析
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wxa/learn/guide/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/wxa/core/" class="nav-link router-link-active">
  CORE
</a></div><div class="nav-item"><a href="/wxa/cli/" class="nav-link">
  CLI
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CORE 运行时插件" class="dropdown-title"><span class="title">CORE 运行时插件</span> <span class="arrow down"></span></button> <button type="button" aria-label="CORE 运行时插件" class="mobile-dropdown-title"><span class="title">CORE 运行时插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/validate.html" class="nav-link">
  Validate 表单校验
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/watch.html" class="nav-link">
  Watch 数据监听
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/redux.html" class="nav-link">
  Redux 全局状态管理
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/core/log.html" class="nav-link">
  Log 日志上报
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CLI 预编译插件" class="dropdown-title"><span class="title">CLI 预编译插件</span> <span class="arrow down"></span></button> <button type="button" aria-label="CLI 预编译插件" class="mobile-dropdown-title"><span class="title">CLI 预编译插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/uglifyjs.html" class="nav-link">
  UglifyJS 代码压缩
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/replace.html" class="nav-link">
  Replace 字符替换
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/copy.html" class="nav-link">
  Copy 静态资源引入
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/hijack.html" class="nav-link">
  hijack 事件劫持
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/minify-wxml.html" class="nav-link">
  Minify-wxml wxml压缩
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/postcss.html" class="nav-link">
  Postcss CSS预处理
</a></li><li class="dropdown-item"><!----> <a href="/wxa/plugin/cli/da.html" class="nav-link">
  DA 依赖分析
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/wxa/core/" aria-current="page" class="sidebar-link">CORE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header"><a href="/wxa/core/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/wxa/core/#用例" class="sidebar-link">用例</a></li></ul></li><li><a href="/wxa/core/API.html" aria-current="page" class="active sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#全局api" class="sidebar-link">全局API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-setmaxrequest" class="sidebar-link">wxa.setMaxRequest</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-setrequestexpiredtime" class="sidebar-link">wxa.setRequestExpiredTime</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-addnopromiseapi" class="sidebar-link">wxa.addNoPromiseApi</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-setdebugmode" class="sidebar-link">wxa.setDebugMode</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-launchapp" class="sidebar-link">wxa.launchApp</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-launchpage" class="sidebar-link">wxa.launchPage</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-launchcomponent" class="sidebar-link">wxa.launchComponent</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-mixin" class="sidebar-link">wxa.mixin</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-use" class="sidebar-link">wxa.use</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-disabledappembed" class="sidebar-link">wxa.disabledAppEmbed</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxa-getwxaplatform" class="sidebar-link">wxa.getWxaPlatform</a></li></ul></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#选项-页面生命周期" class="sidebar-link">选项 / 页面生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#beforerouteenter" class="sidebar-link">beforeRouteEnter</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onload" class="sidebar-link">onLoad</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onshow" class="sidebar-link">onShow</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onready" class="sidebar-link">onReady</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onhide" class="sidebar-link">onHide</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onunload" class="sidebar-link">onUnload</a></li></ul></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#选项-app生命周期" class="sidebar-link">选项 / APP生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onlaunch" class="sidebar-link">onLaunch</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onshow-2" class="sidebar-link">onShow</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onhide-2" class="sidebar-link">onHide</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onerror" class="sidebar-link">onError</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onpagenotfound" class="sidebar-link">onPageNotFound</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onunhandledrejection" class="sidebar-link">onUnhandledRejection</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#onthemechange" class="sidebar-link">onThemeChange</a></li></ul></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#实例-property" class="sidebar-link">实例 / property</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#vm-diff" class="sidebar-link">vm.$diff</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#vm-go" class="sidebar-link">vm.$go</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#vm-app" class="sidebar-link">vm.$app</a></li></ul></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#decorators-类装饰器" class="sidebar-link">Decorators / 类装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#app" class="sidebar-link">App</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#page" class="sidebar-link">Page</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#eventbus" class="sidebar-link">Eventbus</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#fetch" class="sidebar-link">Fetch</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#mixins" class="sidebar-link">Mixins</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#router" class="sidebar-link">Router</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#storage" class="sidebar-link">Storage</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#sessionstorage" class="sidebar-link">SessionStorage</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#utils" class="sidebar-link">Utils</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxapi" class="sidebar-link">Wxapi</a></li></ul></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#decorators-方法装饰器" class="sidebar-link">Decorators / 方法装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#debounce" class="sidebar-link">Debounce</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#delay" class="sidebar-link">Delay</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#deprecate" class="sidebar-link">Deprecate</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#loading" class="sidebar-link">Loading</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#lock" class="sidebar-link">Lock</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#once" class="sidebar-link">Once</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#throttle" class="sidebar-link">Throttle</a></li></ul></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#其他" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxa/core/API.html#message-title-content-options" class="sidebar-link">message( title, content, options )</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#toast-title-options" class="sidebar-link">toast( title, options )</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#eventbus-2" class="sidebar-link">eventbus</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#fetch-2" class="sidebar-link">fetch</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#router-2" class="sidebar-link">router</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#storage-2" class="sidebar-link">storage</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#sessionstorage-2" class="sidebar-link">sessionStorage</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#utils-2" class="sidebar-link">utils</a></li><li class="sidebar-sub-header"><a href="/wxa/core/API.html#wxapi-2" class="sidebar-link">wxapi</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="全局api"><a href="#全局api" class="header-anchor">#</a> 全局API</h2> <h3 id="wxa-setmaxrequest"><a href="#wxa-setmaxrequest" class="header-anchor">#</a> wxa.setMaxRequest</h3> <p><code>wxa.setMaxRequest( number )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>number</strong> <code>Number</code> <strong>Default</strong>: 5</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span>

<span class="token comment">// 最大并发4个请求，多余请求在队列排队等待</span>
wxa<span class="token punctuation">.</span><span class="token function">setMaxRequest</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>设置最多同时并发的网络请求。</p> <p>微信<code>wx.request</code>接口最多同时并发10个请求，超过10个请求将会被抛弃。wxa提供了一层request包装，引入队列控制并发请求。小程序业务层可以不关心并发多少个请求的问题，wxa将会保证每个请求都发出去。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>最大并发请求不应该设置超过10<br>
超过最大并发的请求都会在队列等待其他请求完成后按顺序发出</p></div> <h3 id="wxa-setrequestexpiredtime"><a href="#wxa-setrequestexpiredtime" class="header-anchor">#</a> wxa.setRequestExpiredTime</h3> <p><code>wxa.setRequestExpiredTime( ms )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>ms</strong>: <code>Number</code> 毫秒 <strong>Default</strong>: 500ms</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span>

wxa<span class="token punctuation">.</span><span class="token function">setRequestExpiredTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>设置post请求失效缓存失效时间。</p> <p>使用wxa的<code>fetch</code>方法发送网络请求，wxa会缓存每个post请求，当客户端在一定时间内连续发送同一个请求的时候，wxa会主动reject并返回<code>{code: -101}</code>。相当于做一层前端post请求防重复。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>wxa的前端防重机制大部分时间下可以很好的处理绝大多数请求重复的case。但是如果业务比较复杂，例如遇到多异步请求的事务性业务的时候，http层的请求防重并不能解决问题，wxa另外提供了一个<code>Lock</code>装饰器来处理这种情况。</p></div> <h3 id="wxa-addnopromiseapi"><a href="#wxa-addnopromiseapi" class="header-anchor">#</a> wxa.addNoPromiseApi</h3> <p><code>wxa.addNoPromiseApi( name )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>name</strong>: <code>[String, Array]</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span>

wxa<span class="token punctuation">.</span><span class="token function">addNoPromiseApi</span><span class="token punctuation">(</span><span class="token string">'getRecorderManager'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wxa<span class="token punctuation">.</span><span class="token function">addNoPromiseApi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'uploadFile'</span><span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>wxa尝试为所有<code>wx.**</code>的方法做一次promise化，但是有一些同步的api却不应该这么做，因为他们会直接返回某个句柄或者结果值，如果为他们做了promise化，这些返回将会被损失。</p> <h3 id="wxa-setdebugmode"><a href="#wxa-setdebugmode" class="header-anchor">#</a> wxa.setDebugMode</h3> <p><code>wxa.setDebugMode( mode )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>mode</strong>: <code>false</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

wxa<span class="token punctuation">.</span><span class="token function">setDebugMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>debug模式，wxa会打印更详细的debug信息用于调试，项目上线后请关闭该选项。</p> <h3 id="wxa-launchapp"><a href="#wxa-launchapp" class="header-anchor">#</a> wxa.launchApp</h3> <p><code>wxa.launchApp( instance )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>instance</strong> <code>[Object, Array]</code> 小程序App类或者对象实例</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.js / app.wxa</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token comment">// 传递一个App对象</span>
wxa<span class="token punctuation">.</span><span class="token function">launchApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    globalData<span class="token operator">:</span> <span class="token punctuation">{</span>
        userInfo<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'Genuifx'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 小程序生命周期函数</span>
    <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 传递一个App类</span>
wxa<span class="token punctuation">.</span><span class="token function">launchApp</span><span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    globalData <span class="token operator">=</span> <span class="token punctuation">{</span>
        userInfo<span class="token operator">:</span>  <span class="token punctuation">{</span>
            userInfo<span class="token operator">:</span> <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">'Genuifx'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 小程序生命周期函数</span>
    <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>注册一个小程序，接受一个类或对象实例，相当于小程序原生开发中显式调用<code>App()</code>。</p> <p><code>wxa.launchApp</code>会在内部调用<code>App()</code>函数，并在这之前对实例进行<code>mixins</code>处理和插件应用。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>最佳实践是传递一个类，这样可以享受wxa提供的Decorator的便利。</p></div> <h3 id="wxa-launchpage"><a href="#wxa-launchpage" class="header-anchor">#</a> wxa.launchPage</h3> <p><code>wxa.launchPage( instance )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>instance</strong> <code>[Object, Array]</code> 小程序页面类或对象实例</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js / index.wxa</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token comment">// 传递一个App类</span>
wxa<span class="token punctuation">.</span><span class="token function">launchPage</span><span class="token punctuation">(</span>
    <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'Genuifx'</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 小程序生命周期函数</span>
        <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token comment">// 页面事件响应函数</span>
        <span class="token keyword">async</span> <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>注册一个小程序页面，接受一个类或对象实例，相当于小程序原生开发中显式调用<code>Page()</code>。</p> <p><code>wxa.launchPage</code>会为加载全局和局部<code>mixins</code>、添加<code>$go</code>和<code>$diff</code>函数到页面实例，最后应用插件到实例。</p> <h3 id="wxa-launchcomponent"><a href="#wxa-launchcomponent" class="header-anchor">#</a> wxa.launchComponent</h3> <p><code>wxa.launchComponent( instance )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>instance</strong> <code>[Object, Array]</code> 小程序自定义组件类或对象实例</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js / index.wxa</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token comment">// 传递一个App类</span>
wxa<span class="token punctuation">.</span><span class="token function">launchComponent</span><span class="token punctuation">(</span>
    <span class="token keyword">class</span> <span class="token class-name">Popup</span> <span class="token punctuation">{</span>
        properties <span class="token operator">=</span> <span class="token punctuation">{</span>
            text<span class="token operator">:</span> String
        <span class="token punctuation">}</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'Genuifx'</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 小程序组件生命周期函数</span>
        <span class="token function">attached</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token comment">// 组件事件响应函数</span>
        <span class="token keyword">async</span> <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>注册一个小程序自定义组件，接受一个类或对象实例，相当于小程序原生开发中显式调用<code>Component()</code>。</p> <p><code>wxa.launchComponent</code>会为加载全局和局部<code>mixins</code>、添加<code>$diff</code>函数到页面实例，最后应用插件到实例。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用@wxa/cli2可以不需要手动调用这些注册方法，直接导出对应类即可，cli会通过注入脚本，自动调用该方法。
示例：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.wxa 使用cli2编译项目</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>App<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@App
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token comment">// your logic here.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <h3 id="wxa-mixin"><a href="#wxa-mixin" class="header-anchor">#</a> wxa.mixin</h3> <p><code>wxa.mixin( mixin )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>mixin</strong>: <code>[Class, Object]</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>添加一个全局mixin，所有页面实例和自定义组件实例都应用到。一般用于挂载项目中常用的函数方法到页面。</p> <h3 id="wxa-use"><a href="#wxa-use" class="header-anchor">#</a> wxa.use</h3> <p><code>wxa.use( plugin, options )</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>plugin</strong>: <code>Function</code> 一个高级函数</li> <li><strong>options</strong>: <code>Object</code> 传递给插件的参数</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> watchPlugin <span class="token keyword">from</span> <span class="token string">'@wxa/watch'</span>
<span class="token comment">// 挂载插件</span>
wxa<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>watchPlugin<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// index.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        formData<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    watch <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 监听formData.name的变化</span>
        <span class="token string">'formData.name'</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                valid<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>newValue
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>添加一个插件，该插件可以应用到App实例、页面实例和自定义组件实例。插件一般用于实现特定的通用功能，比如<code>watch</code>插件，使得小程序也可以监听data数据的变化，做出相应响应，效果和vue的<code>computed</code>类似。</p> <h3 id="wxa-disabledappembed"><a href="#wxa-disabledappembed" class="header-anchor">#</a> wxa.disabledAppEmbed</h3> <p><code>wxa.disabledAppEmbed()</code></p> <ul><li><strong>用例</strong>:</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>
wxa<span class="token punctuation">.</span><span class="token function">disabledAppEmbed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>取消自动注入<code>$app</code>对象</p> <h3 id="wxa-getwxaplatform"><a href="#wxa-getwxaplatform" class="header-anchor">#</a> wxa.getWxaPlatform</h3> <p><code>wxa.getWxaPlatform()</code></p> <ul><li><p><strong>返回值</strong>: <code>String</code> 当前小程序运行的平台类型, <code>wechat</code> 微信小程序、 <code>tt</code> 头条小程序</p></li> <li><p><strong>用例</strong>:</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxa<span class="token punctuation">,</span> Page<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@Page
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>wxa<span class="token punctuation">.</span><span class="token function">getWxaPlatform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'tt'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 头条小程序</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 微信小程序</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>用于编写跨平台小程序代码使用</p> <h2 id="选项-页面生命周期"><a href="#选项-页面生命周期" class="header-anchor">#</a> 选项 / 页面生命周期</h2> <h3 id="beforerouteenter"><a href="#beforerouteenter" class="header-anchor">#</a> beforeRouteEnter</h3> <ul><li><strong>类型</strong>: <code>Function</code></li> <li><strong>用法</strong>：</li></ul> <p>在路由开始跳转，页面实例化之前被执行。即拿不到页面实例，也访问不到任何页面实例数据。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>beforeRouteEnter</code>是wxa框架特有的生命周期，必须使用<code>router.*</code>方法压栈的方法才会触发。</p> <p>利用<code>beforeRouteEnter</code>, 可以实现小程序页面数据的预加载。</p></div> <h3 id="onload"><a href="#onload" class="header-anchor">#</a> onLoad</h3> <p>onLoad(Object query)
页面加载时触发。一个页面只会调用一次，可以在 onLoad 的参数中获取打开当前页面路径中的参数。</p> <p>参数：</p> <table><thead><tr><th>名称</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>query</td> <td>Object</td> <td>打开当前页面路径中的参数</td></tr></tbody></table> <h3 id="onshow"><a href="#onshow" class="header-anchor">#</a> onShow</h3> <p>页面显示/切入前台时触发。</p> <h3 id="onready"><a href="#onready" class="header-anchor">#</a> onReady</h3> <p>页面初次渲染完成时触发。一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互。</p> <p>注意：对界面内容进行设置的 API 如wx.setNavigationBarTitle，请在onReady之后进行。详见生命周期</p> <h3 id="onhide"><a href="#onhide" class="header-anchor">#</a> onHide</h3> <p>页面隐藏/切入后台时触发。 如 wx.navigateTo 或底部 tab 切换到其他页面，小程序切入后台等。</p> <h3 id="onunload"><a href="#onunload" class="header-anchor">#</a> onUnload</h3> <p>页面卸载时触发。如wx.redirectTo或wx.navigateBack到其他页面时。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>原生小程序所有生命周期回调函数都不变，具体请查看</p> <ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0" target="_blank" rel="noopener noreferrer">页面生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/component.html" target="_blank" rel="noopener noreferrer">自定义组件生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <h2 id="选项-app生命周期"><a href="#选项-app生命周期" class="header-anchor">#</a> 选项 / APP生命周期</h2> <blockquote><p>官方文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/app.html" target="_blank" rel="noopener noreferrer">App生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="onlaunch"><a href="#onlaunch" class="header-anchor">#</a> onLaunch</h3> <p>小程序初始化完成时触发，全局只触发一次。参数也可以使用 wx.getLaunchOptionsSync 获取。</p> <p>参数：与 wx.getLaunchOptionsSync 一致</p> <h3 id="onshow-2"><a href="#onshow-2" class="header-anchor">#</a> onShow</h3> <p>小程序启动，或从后台进入前台显示时触发。也可以使用 wx.onAppShow 绑定监听。</p> <p>参数：与 wx.onAppShow 一致</p> <h3 id="onhide-2"><a href="#onhide-2" class="header-anchor">#</a> onHide</h3> <p>小程序从前台进入后台时触发。也可以使用 wx.onAppHide 绑定监听。</p> <h3 id="onerror"><a href="#onerror" class="header-anchor">#</a> onError</h3> <p>小程序发生脚本错误或 API 调用报错时触发。也可以使用 wx.onError 绑定监听。</p> <p>参数：与 wx.onError 一致</p> <h3 id="onpagenotfound"><a href="#onpagenotfound" class="header-anchor">#</a> onPageNotFound</h3> <p>基础库 1.9.90 开始支持，低版本需做兼容处理。</p> <p>小程序要打开的页面不存在时触发。也可以使用 wx.onPageNotFound 绑定监听。注意事项请参考 wx.onPageNotFound。</p> <p>参数：与 wx.onPageNotFound 一致</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onPageNotFound</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token string">'pages/...'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 如果是 tabbar 页面，请使用 wx.switchTab</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="onunhandledrejection"><a href="#onunhandledrejection" class="header-anchor">#</a> onUnhandledRejection</h3> <p>基础库 2.10.0 开始支持，低版本需做兼容处理。</p> <p>小程序有未处理的 Promise 拒绝时触发。也可以使用 wx.onUnhandledRejection 绑定监听。注意事项请参考 wx.onUnhandledRejection。</p> <p>参数：与 wx.onUnhandledRejection 一致</p> <h3 id="onthemechange"><a href="#onthemechange" class="header-anchor">#</a> onThemeChange</h3> <p>基础库 2.11.0 开始支持，低版本需做兼容处理。</p> <p>系统切换主题时触发。也可以使用 wx.onThemeChange 绑定监听。</p> <p>参数：与 wx.onThemeChange 一致</p> <h2 id="实例-property"><a href="#实例-property" class="header-anchor">#</a> 实例 / property</h2> <h3 id="vm-diff"><a href="#vm-diff" class="header-anchor">#</a> vm.$diff</h3> <p><code>vm.$diff( newData, cb)</code></p> <ul><li><strong>参数</strong>:
<ul><li><strong>newData</strong>: <code>Object</code> 更新的数据</li> <li><strong>cb</strong>: <code>Function</code> setData引起的界面更新渲染完毕后的回调函数</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>对更新的数据进行<code>diff</code>，然后根据小程序setData的特性进行<code>flatten</code>处理之后，在调用setData设置数据，以得到增量更新的效果，对于大的Object而言有很好效益，提高setData效率，减少重绘。</p> <h3 id="vm-go"><a href="#vm-go" class="header-anchor">#</a> vm.$go</h3> <p><code>vm.$go( event )</code></p> <ul><li><strong>参数</strong>：
<ul><li><strong>event</strong>：小程序事件回调对象。</li></ul></li> <li><strong>用例</strong>：</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 相当于调用this.$router.push('/pages/log') --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$go<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pages/log<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去日志页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 相当于调用this.$router.replace('/pages/log') --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$go<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>replace<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pages/log<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去日志页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>重构阶段可以无需写任何逻辑，快速实现页面之间的跳转。</p> <h3 id="vm-app"><a href="#vm-app" class="header-anchor">#</a> vm.$app</h3> <p><code>vm.$app</code> app 实例，等同于相当于调用 <code>getApp()</code></p> <h2 id="decorators-类装饰器"><a href="#decorators-类装饰器" class="header-anchor">#</a> Decorators / 类装饰器</h2> <p>wxa基于最新的<a href="https://github.com/tc39/proposal-decorators/blob/master/METAPROGRAMMING.md" target="_blank" rel="noopener noreferrer">proposal-decorators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 编写了丰富的类装饰器。通过拦截，改写等方式，对类进行增强。</p> <p>大部分类装饰器，都提供了单独调用的方法，譬如对应缓存操作，wxa有装饰器<code>Storage</code>和单独的<code>storage</code>对象。</p> <p>Decorators方式如下:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Storage<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span>

@Storage
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'MSG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>直接使用:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>storage<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> abc <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>类装饰器新增的方法一般都一<code>$</code>开头哟~，譬如<code>$diff</code>, <code>$storage</code>，<code>$router</code>等等，这一点与<code>@wxa/core@1.x</code>不一致。</p></div> <p>由于在实际项目开发中，一般都会用到很多好用的Decorator，于是在其他类装饰器的基础上，wxa又包装了<code>App</code>和<code>Page</code>装饰器，以满足日常开发需要。</p> <h3 id="app"><a href="#app" class="header-anchor">#</a> App</h3> <p>App装饰器是<code>Utils</code>, <code>Storage</code>, <code>Wxapi</code>, <code>Router</code>, <code>Eventbus</code>, <code>Fetch</code>的集合。使用了App装饰器等于同时使用了上述所有功能装饰器。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>@App
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 使用fetch获取数据</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'https://remote/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 使用router方法跳转路由</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/pages/log/log'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">boo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 触发一个something happened的事件。</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'somthing happened'</span><span class="token punctuation">,</span> <span class="token string">'Hey Guys!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="page"><a href="#page" class="header-anchor">#</a> Page</h3> <p>Page装饰器是<code>Utils</code>, <code>Storage</code>, <code>Wxapi</code>, <code>Router</code>, <code>Eventbus</code>, <code>Fetch</code>的集合。使用了Page装饰器等于同时使用了上述所有功能装饰器。</p> <p>另外，<code>Page</code>装饰器还是自动注入app实例到<code>$app</code>上。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>@Page
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取app实例</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$app<span class="token punctuation">.</span>isDEBUG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">'Genuifx'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//获取远程数据</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'remote/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="eventbus"><a href="#eventbus" class="header-anchor">#</a> Eventbus</h3> <p>在小程序中，跨页面，跨组件的共享状态是一个比较难以解决的问题，全局状态管理方案<code>@wxa/Redux</code>可以优雅的解决该问题，除<code>redux</code>方案之外，wxa还提供了一个简易的自定义事件管理，允许开发者快速开发跨页面，跨组件的业务需求。</p> <p>简单示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// a.js</span>
@Eventbus
<span class="token keyword">class</span> <span class="token class-name">APage</span> <span class="token punctuation">{</span>
    <span class="token function">boo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 监听一个事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// b.js</span>
@Eventbus
<span class="token keyword">class</span> <span class="token class-name">BPage</span> <span class="token punctuation">{</span>
    <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 触发事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="on-name-handler-scope"><a href="#on-name-handler-scope" class="header-anchor">#</a> on( name, handler, scope? )</h4> <ul><li><strong>参数</strong> <ul><li><strong>name</strong>: <code>String</code> 监听的自定义事件名</li> <li><strong>handler</strong>: <code>Function</code> 回调函数</li> <li><strong>scope?</strong>: <code>String</code> 事件域</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>监听一个自定义事件，当事件触发的时候执行对应回调函数。</p> <h4 id="once-name-handler-scope"><a href="#once-name-handler-scope" class="header-anchor">#</a> once( name, handler, scope? )</h4> <ul><li><strong>参数</strong> <ul><li><strong>name</strong>: <code>String</code> 监听的自定义事件名</li> <li><strong>handler</strong>: <code>Function</code> 回调函数</li> <li><strong>scope?</strong>: <code>String</code> 事件域</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>一次性监听一个自定义事件，当事件触发的时候执行对应回调函数，执行完毕后取消监听。</p> <h4 id="off-name-handler"><a href="#off-name-handler" class="header-anchor">#</a> off( name, handler )</h4> <ul><li><strong>参数</strong> <ul><li><strong>name</strong>: <code>String</code> 监听的自定义事件名</li> <li><strong>handler</strong>: <code>Function</code> 对应回调函数</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>取消监听一个自定义事件。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>在页面被注销的时候记得取消监听事件，避免内存泄漏！</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>@Page 
<span class="token keyword">class</span> <span class="token class-name">Idx</span> <span class="token punctuation">{</span>
    <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">onUnload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div> <h4 id="emit-name-payload"><a href="#emit-name-payload" class="header-anchor">#</a> emit( name, payload )</h4> <ul><li><strong>参数</strong> <ul><li><strong>name</strong>: <code>String</code> 监听的自定义事件名</li> <li><strong>payload</strong>: <code>[Object, String, Number]</code> 回调函数接受的参数</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>触发一个自定义事件</p> <h4 id="clear-name"><a href="#clear-name" class="header-anchor">#</a> clear( name )</h4> <ul><li><strong>参数</strong> <ul><li><strong>name</strong>: <code>[String, Null]</code> 监听的自定义事件名</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 注意这么写会清空所有事件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 清楚所有event事件监听</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$eventbus<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>清空指定事件回调，或者清空所有事件回调</p> <h3 id="fetch"><a href="#fetch" class="header-anchor">#</a> Fetch</h3> <p><code>wxa</code>为网络请求提供了一个好用的<code>Fetch</code>装饰器，通过<code>fetch</code>，开发者可以快速的发起请求，而不需要担心<code>wx.request</code>引发的其他问题。</p> <p><code>fetch</code>api具有promise化，队列化请求的能力，同时具备对<code>post</code>请求的短时间防重。</p> <h4 id="fetch-url-data-configs-method"><a href="#fetch-url-data-configs-method" class="header-anchor">#</a> fetch( url, data, configs, method )</h4> <ul><li><strong>参数</strong> <ul><li><strong>url</strong>: <code>String</code> 接口地址</li> <li><strong>data</strong>: <code>Object</code> 请求携带的数据</li> <li><strong>configs</strong>: <code>Object</code> 请求的配置
<ul><li><strong>$top</strong>: <code>Boolean</code> 高优先级请求，直接压入等待队列的列首</li> <li><strong>$noCache</strong>: <code>Boolean</code> 指定该请求做防重处理</li> <li><strong>$withCancel</strong>: <code>Boolean</code> <code>default: false</code> 是否需要主动取消请求，如是则返回一个 <code>Object</code>，其中包含 <code>request</code> (当前这次请求的 promise) <code>cancel</code> 函数，主动执行用于取消该请求。默认直接返回一个 <code>promise</code>。</li> <li>其他小程序默认的配置都放在这里，例如header，dataType，具体参数可以参考<a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html" target="_blank" rel="noopener noreferrer">小程序文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>method</strong>: <code>String</code> 请求方式, get, post。</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>@Fetch
<span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> succ <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'/remote/user/get'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// other logic</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="mixins"><a href="#mixins" class="header-anchor">#</a> Mixins</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Mixins( [mixin]+ )</code></li></ul></li> <li><strong>参数</strong> <ul><li><strong>mixin</strong> 混合对象，可以为Object或者Class。</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>混合多个对象或Class的方法，数据，生命周期到当前App/页面/组件类。data将会做一次deep merge，方法按顺序覆盖，生命周期函数则按顺序执行。</p> <ul><li><strong>参考</strong>:</li></ul> <p>指南：对象混合</p> <h3 id="router"><a href="#router" class="header-anchor">#</a> Router</h3> <p>简洁的路由API，用于跳转小程序路由页面。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用<code>Router</code>提供的路由方法跳转，可以享受wxa提供的预加载特性，具体请查看生命周期<code>beforeRouteEnter</code>文档。</p></div> <h4 id="get"><a href="#get" class="header-anchor">#</a> get( )</h4> <ul><li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// {_webviewid: 1, route: 'pages/index/index', ...}</span>
<span class="token keyword">let</span> currentPage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>获取当前路由页面信息</p> <h4 id="getall"><a href="#getall" class="header-anchor">#</a> getAll( )</h4> <ul><li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取完整的页面栈</span>
<span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>获取当前路由栈，相当于调用了小程序的<code>getCurrentPages()</code>。</p> <h4 id="push-path"><a href="#push-path" class="header-anchor">#</a> push( path )</h4> <ul><li><strong>参数</strong> <ul><li><strong>path</strong>: <code>String</code> 页面路由路径，相对路径或绝对路径</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 直接跳转</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/pages/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 跳转完成后做一些特殊处理</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/pages/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$storage<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'hasTravel'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'跳转失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>跳转到新路由页面，入栈路由。</p> <h4 id="replace-path"><a href="#replace-path" class="header-anchor">#</a> replace( path )</h4> <ul><li><strong>参数</strong> <ul><li><strong>path</strong>: <code>String</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>关闭当前页面，打开新的指定页面。</p> <h4 id="relaunch-path"><a href="#relaunch-path" class="header-anchor">#</a> reLaunch( path )</h4> <ul><li><strong>参数</strong> <ul><li><strong>path</strong>: <code>String</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>关闭所有页面栈中的页面，重新打开指定页面。</p> <h4 id="switch-path"><a href="#switch-path" class="header-anchor">#</a> switch( path )</h4> <ul><li><strong>参数</strong> <ul><li><strong>path</strong>: <code>String</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>切换tabar页面。</p> <h4 id="go-delta"><a href="#go-delta" class="header-anchor">#</a> go( delta )</h4> <ul><li><strong>参数</strong> <ul><li><strong>delta</strong>: <code>Number</code> 回退的页面数</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>回退页面, delta为欲回退页面数。</p> <h4 id="goback"><a href="#goback" class="header-anchor">#</a> goBack( )</h4> <ul><li><strong>用例</strong>:</li></ul> <p>回退上一个页面，相当于调用<code>this.$router.go(-1)</code>。</p> <h4 id="close"><a href="#close" class="header-anchor">#</a> close( )</h4> <ul><li><strong>用例</strong>:</li></ul> <p>关闭小程序。</p> <p>⚠️谨慎调用，将会直接关闭小程序。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p><code>this.$router.close()</code>方法已无法主动关闭小程序。需要关闭小程序请参考以下代码：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>miniProgram<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>关闭小程序<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h3 id="storage"><a href="#storage" class="header-anchor">#</a> Storage</h3> <p>缓存操作。挂载于<code>this.$storge</code>, storage方法包装了同步的<code>wx.storage</code>方法，提供简洁api。</p> <p>值得一提的是，storage缓存的数据会做一次<code>JSON.stringify</code>操作，在读取数据的时候再做相应的<code>JSON.parse</code>后返回。故而storage可以直接缓存非<code>Primitive Type</code>的数据，当然函数除外~</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>storage并不能存<code>Function</code>类型的数据或带有循环引用的对象。</p> <p>缓存的数据在删除小程序后会丢失。</p></div> <p>示例代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Storage Decorator</span>
@Storage
<span class="token keyword">class</span> <span class="token class-name">Center</span> <span class="token punctuation">{</span>
    <span class="token function">travel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$storage<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'keyOfValue'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Genuifx'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="set-key-value"><a href="#set-key-value" class="header-anchor">#</a> set( key, value )</h4> <ul><li><strong>参数</strong>:
<ul><li><strong>key</strong>: <code>String</code></li> <li><strong>value</strong>: <code>Any</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>同步的缓存数据到storage。</p> <h4 id="get-key"><a href="#get-key" class="header-anchor">#</a> get( key )</h4> <ul><li><strong>参数</strong> :
<ul><li><strong>key</strong>: <code>String</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>同步的获取缓存数据。</p> <h4 id="remove-key"><a href="#remove-key" class="header-anchor">#</a> remove( key )</h4> <ul><li><strong>参数</strong> :
<ul><li><strong>key</strong>: <code>String</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>清除指定key的缓存数据。</p> <h4 id="clear"><a href="#clear" class="header-anchor">#</a> clear( )</h4> <ul><li><strong>用例</strong>:</li></ul> <p>⚠️清除所有的缓存数据。</p> <h3 id="sessionstorage"><a href="#sessionstorage" class="header-anchor">#</a> SessionStorage</h3> <h4 id="set-key-value-scope"><a href="#set-key-value-scope" class="header-anchor">#</a> set( key, value, scope? )</h4> <ul><li><strong>参数</strong>:
<ul><li><strong>key</strong>: <code>String</code></li> <li><strong>value</strong>: <code>Any</code></li> <li><strong>scope</strong>: <code>String</code> <code>defaul: 'global'</code> 可以区分缓存数据位置，默认 <code>global</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <h4 id="get-key-scope"><a href="#get-key-scope" class="header-anchor">#</a> get( key, scope? )</h4> <ul><li><strong>参数</strong> :
<ul><li><strong>key</strong>: <code>String</code></li> <li><strong>scope</strong>: <code>String</code> <code>defaul: 'global'</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <h4 id="remove-key-scope"><a href="#remove-key-scope" class="header-anchor">#</a> remove( key, scope? )</h4> <ul><li><strong>参数</strong> :
<ul><li><strong>key</strong>: <code>String</code></li> <li><strong>scope</strong>: <code>String</code> <code>defaul: 'global'</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>清除指定key的缓存数据。</p> <h4 id="clear-scope"><a href="#clear-scope" class="header-anchor">#</a> clear( scope? )</h4> <ul><li><strong>参数</strong> :
<ul><li><strong>scope</strong>: <code>String</code> <code>defaul: 'global'</code> 传 '*' 将清理全部 scope 下的数据</li></ul></li> <li><strong>用例</strong>:</li></ul> <p>清除所有的缓存数据。</p> <h3 id="utils"><a href="#utils" class="header-anchor">#</a> Utils</h3> <p>工具函数集</p> <h4 id="formatdate-timestap-format"><a href="#formatdate-timestap-format" class="header-anchor">#</a> formatDate( timestap, format )</h4> <ul><li><strong>参数</strong> <ul><li><strong>timestap</strong>: <code>[Number, String]</code></li> <li><strong>format</strong>: <code>String</code> 格式化后的时间格式，默认<code>'yyyy-MM-dd hh:mm:ss'</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> dateStr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$utils<span class="token punctuation">.</span><span class="token function">formatDate</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>格式化时间戳为指定格式的字符串</p> <h4 id="trim-str"><a href="#trim-str" class="header-anchor">#</a> trim( str )</h4> <ul><li><strong>参数</strong> <ul><li><strong>str</strong>: <code>String</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> trimStr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$utils<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于小程序部分终端不支持<code>.trim</code>方法，所以wxa提供了一个补丁方法。</p> <h4 id="compareversion-v1-v2"><a href="#compareversion-v1-v2" class="header-anchor">#</a> compareVersion( v1, v2 )</h4> <ul><li><strong>参数</strong> <ul><li><strong>v1</strong>: <code>String</code> version</li> <li><strong>v2</strong>: <code>String</code> version</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token string">'1.2.1'</span><span class="token punctuation">,</span> <span class="token string">'1.1.0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token string">'2.0.7'</span><span class="token punctuation">,</span> <span class="token string">'2.2.0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -1</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token string">'1.1.0'</span><span class="token punctuation">,</span> <span class="token string">'1.1.0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>小程序官方提供的基础库比较函数。如果v1等于v2则返回0，v1大于v2则返回1，v1小于v2则返回-1。</p> <h3 id="wxapi"><a href="#wxapi" class="header-anchor">#</a> Wxapi</h3> <p>尝试对所有<code>wx.*</code>的方法做一次<code>promisify</code>操作，返回一个异步的小程序函数。开发者可以直接使用promise处理异步问题，也可以搭配<code>Async/Await</code>使用。示例如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 获取地理位置</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>latitude<span class="token punctuation">,</span> longtitude<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'wgs84'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 扫一扫</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">scanCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 登录接口</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>对于同步的方法，不做任何包装直接返回函数执行结果：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 同步获取手机信息</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 同步获取小程序更新器句柄</span>
<span class="token keyword">let</span> manager <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">getUpdateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>wxapi对所有微信api一次promise化。其中不会做promisify的方法有：<code>create*</code>方法，<code>on*</code>， <code>*Sync</code>方法和<code>getUpdateManager</code>方法。</p> <p>使用<code>wxa.addNoPromiseApi</code>可以手动添加方法，避免被方法被错误的promise化</p></div> <h2 id="decorators-方法装饰器"><a href="#decorators-方法装饰器" class="header-anchor">#</a> Decorators / 方法装饰器</h2> <p>顾名思义，即作用于具体的类成员函数上的装饰器。</p> <p>Methods装饰器有着广泛的用途。</p> <h3 id="debounce"><a href="#debounce" class="header-anchor">#</a> Debounce</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Debounce( wait, [options={}] )</code></li> <li><code>@Debounce</code></li></ul></li> <li><strong>参数</strong> <ul><li><strong>wait</strong>: <code>Number</code> 延时多少毫秒之后执行函数 <strong>Default</strong>: 300</li> <li><strong>options</strong>: <code>Object</code> 参数对象
<ul><li><strong>leading</strong>: <code>Boolean</code> 指定是否在超时之前触发函数。 <strong>Default</strong>: <code>true</code></li> <li><strong>maxWait</strong>: <code>Number</code> 在函数触发前最大延时时间。</li> <li><strong>trailing</strong>: <code>Boolean</code> 指定是否在超时之后触发函数。 <strong>Default</strong>: <code>false</code></li></ul></li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Page<span class="token punctuation">,</span> Debounce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@Page
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认立刻执行函数，并且在一定延迟之内不会重复执行。</span>
    @Debounce
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'pages/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 指定延迟时间</span>
    @<span class="token function">Debounce</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token function">longTap</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>detail<span class="token operator">:</span> value<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            phone<span class="token operator">:</span> value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>debounce，又称反抖动函数。大量应用于控制用户交互事件行为（点击，滑动等），由于用户可能误触引发事件回调，如果不加以控制，可能引起重复的后台请求。</p> <p>故而，几乎所有用户交互事件都需要开发者做对应控制，这个时间一个Debounce装饰器可以帮助你优雅的开发业务代码😍</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>debounce函数，详见<a href="https://lodash.com/docs/4.17.10#debounce" target="_blank" rel="noopener noreferrer"><code>lodash debounce</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>;</p></div> <h3 id="delay"><a href="#delay" class="header-anchor">#</a> Delay</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Delay( wait )</code></li></ul></li> <li><strong>参数</strong> <ul><li><strong>wait</strong>: <code>Number</code> 延时多少毫秒之后执行函数</li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Page<span class="token punctuation">,</span> Delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@Page
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    <span class="token comment">// 延迟1000ms之后执行函数</span>
    @<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token function">sleepAndTravel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'pages/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>延迟一段时间后执行函数。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>delay函数，详见<a href="https://lodash.com/docs/4.17.10#delay" target="_blank" rel="noopener noreferrer"><code>lodash delay</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>;</p></div> <h3 id="deprecate"><a href="#deprecate" class="header-anchor">#</a> Deprecate</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Deprecate</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> App<span class="token punctuation">,</span> Deprecate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@App
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    <span class="token comment">// 延迟1000ms之后执行函数</span>
    @Deprecate
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>开发第三方的组件或者多人合作情况下，标识某些方法即将遗弃。继续调用该方法会有一个warning。</p> <h3 id="loading"><a href="#loading" class="header-anchor">#</a> Loading</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Loading( tips, type )</code></li></ul></li> <li><strong>参数</strong> <ul><li><strong>tips</strong>: <code>String</code> loading的文案提示 <strong>Default</strong> <code>Loading</code></li> <li><strong>type</strong>: <code>String</code> 类型，可以指定使用导航栏loading动画或者界面loading动画 <strong>Default</strong> <code>loading</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>自动显示loading动画。有两种类型<code>loading</code>或<code>bar</code>，分别是界面的loading动画及导航栏的动画。</p> <h3 id="lock"><a href="#lock" class="header-anchor">#</a> Lock</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Lock</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>Lock装饰器，与后台的事务锁不同，wxa的锁主要用于防止函数重复执行。在日常开发中，前端防重一直是个很重要的问题。在不用<code>Lock</code>的情况下，我们需要对每个函数都增加一个变量控制：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Page<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@Page
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 是否在做登录中，防止重复登录</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isLoging<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取微信的code，用于从微信后台换取sessionKey</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 后台提供的登录接口</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'/remote/login'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 登录完成，记录状态</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                isLogged<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 重置标志位</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>而使用<code>Lock</code>之后，我们无需关心太多控制逻辑，代码更加清晰了然。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Lock<span class="token punctuation">,</span> Page<span class="token punctuation">,</span> toast<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

@Page 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">{</span>
    @Lock
    <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取微信的code，用于从微信后台换取sessionKey</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wxapi<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 后台提供的登录接口</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'/remote/login'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 登录完成，记录状态</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                isLogged<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'登录失败~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="once"><a href="#once" class="header-anchor">#</a> Once</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Once</code></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>指定函数仅会执行一次，重复的调用只会返回第一次调用的结果。详见<a href="https://lodash.com/docs/4.17.10#once" target="_blank" rel="noopener noreferrer"><code>lodash Once</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>;</p> <h3 id="throttle"><a href="#throttle" class="header-anchor">#</a> Throttle</h3> <ul><li><strong>调用方式</strong> <ul><li><code>@Throttle( wait, [options={}] )</code></li> <li><code>@Throttle</code></li></ul></li> <li><strong>参数</strong> <ul><li><strong>wait</strong>: <code>Number</code> 每隔<code>wait</code>毫秒仅执行函数一次 <strong>Default</strong>: 1000</li> <li><strong>options</strong>: <code>Object</code> 参数对象
<ul><li><strong>leading</strong>: <code>Boolean</code> 指定是否在超时之前触发函数。 <strong>Default</strong>: <code>true</code></li> <li><strong>trailing</strong>: <code>Boolean</code> 指定是否在超时之后触发函数。 <strong>Default</strong>: <code>true</code></li></ul></li></ul></li> <li><strong>用例</strong>:</li></ul> <p>限流函数。一般适用于持续高频触发的交互，比如<code>input</code>，<code>scroll</code>等短时间内有可能多次触发回调函数，密集的计算可能导致界面卡顿问题，这个时候一个限流函数就大有用武之地了。</p> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <h3 id="message-title-content-options"><a href="#message-title-content-options" class="header-anchor">#</a> message( title, content, options )</h3> <ul><li><strong>参数</strong>:
<ul><li><strong>title</strong>: <code>String</code> 标题</li> <li><strong>content</strong>：<code>String</code> 内容</li> <li><strong>options</strong>：<code>Object</code> 参考<a href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showModal.html" target="_blank" rel="noopener noreferrer">微信文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <p>显示模态对话框。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token comment">// 简单的消息提示</span>
<span class="token function">message</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'网络错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 处理回调</span>
<span class="token function">message</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'是否选择放弃'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>showCancel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> confirmText<span class="token operator">:</span> <span class="token string">'No'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>confirm<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Never Give Up~'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="toast-title-options"><a href="#toast-title-options" class="header-anchor">#</a> toast( title, options )</h3> <ul><li><strong>参数</strong>:
<ul><li><strong>title</strong>: <code>String</code> 标题</li> <li><strong>options</strong>：<code>Object</code> 参考<a href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showToast.html" target="_blank" rel="noopener noreferrer">微信文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <p>显示消息提示框</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>toast<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token comment">// 简单的消息</span>
<span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'输入有误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 处理回调</span>
<span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'输入有误'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'callback here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>toast 会默认帮你打开mask，防止用户误触其他回调。</p></div> <h3 id="eventbus-2"><a href="#eventbus-2" class="header-anchor">#</a> eventbus</h3> <p>api 同 <a href="#eventbus">Eventbus</a> 直接引入后使用，示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>eventbus<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

evenbuts<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'LOGIN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="fetch-2"><a href="#fetch-2" class="header-anchor">#</a> fetch</h3> <p>api 同 <a href="#fetch">Fetch</a> 直接引入后使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>fetch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/get/xxx'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="router-2"><a href="#router-2" class="header-anchor">#</a> router</h3> <p>api 同 <a href="#router">Router</a> 直接引入后使用，示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>router<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/pages/index/landing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="storage-2"><a href="#storage-2" class="header-anchor">#</a> storage</h3> <p>api 同 <a href="#storage">Storage</a> 直接引入后使用，示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>storage<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

storage<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="sessionstorage-2"><a href="#sessionstorage-2" class="header-anchor">#</a> sessionStorage</h3> <p>api 同 <a href="#sessionStorage">SessionStorage</a> 直接引入后使用，示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>sessionStorage<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

sessionStorage<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="utils-2"><a href="#utils-2" class="header-anchor">#</a> utils</h3> <p>api 同 <a href="#utils">Utils</a> 直接引入后使用，示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>utils<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> defer <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>defer<span class="token punctuation">.</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="wxapi-2"><a href="#wxapi-2" class="header-anchor">#</a> wxapi</h3> <p>api 同 <a href="#wxapi">Wxapi</a> 直接引入后使用，示例如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>wxapi<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wxa/core'</span><span class="token punctuation">;</span>

wxapi<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token string">'/pages/index/landing'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/WeBankFinTech/wxa/edit/master/docs/core/API.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次编辑时间:</span> <span class="time">2020-6-29</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wxa/core/" class="prev router-link-active">
        CORE
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/wxa/assets/js/app.58e7e8f2.js" defer></script><script src="/wxa/assets/js/5.38cbe0cd.js" defer></script><script src="/wxa/assets/js/4.27b682a4.js" defer></script><script src="/wxa/assets/js/16.96744209.js" defer></script><script src="/wxa/assets/js/7.28cc5d92.js" defer></script>
  </body>
</html>
